/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, EventEmitter, HostBinding, HostListener, Input, NgZone, Output, Renderer2 } from "@angular/core";
import { calculateDragImageOffset, setDragData, setDragImage } from "./dnd-utils";
import { dndState, endDrag, startDrag } from "./dnd-state";
import * as ɵngcc0 from '@angular/core';
var DndDragImageRefDirective = /** @class */ (function () {
    function DndDragImageRefDirective(parent, elementRef) {
        parent.registerDragImage(elementRef);
    }
    /** @nocollapse */
    DndDragImageRefDirective.ctorParameters = function () { return [
        { type: DndDraggableDirective },
        { type: ElementRef }
    ]; };
DndDragImageRefDirective.ɵfac = function DndDragImageRefDirective_Factory(t) { return new (t || DndDragImageRefDirective)(ɵngcc0.ɵɵdirectiveInject(DndDraggableDirective), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
DndDragImageRefDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: DndDragImageRefDirective, selectors: [["", "dndDragImageRef", ""]] });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DndDragImageRefDirective, [{
        type: Directive,
        args: [{
                selector: "[dndDragImageRef]"
            }]
    }], function () { return [{ type: DndDraggableDirective }, { type: ɵngcc0.ElementRef }]; }, null); })();
    return DndDragImageRefDirective;
}());
export { DndDragImageRefDirective };
var DndDraggableDirective = /** @class */ (function () {
    function DndDraggableDirective(elementRef, renderer, ngZone) {
        var _this = this;
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.ngZone = ngZone;
        this.dndEffectAllowed = "copy";
        this.dndDraggingClass = "dndDragging";
        this.dndDraggingSourceClass = "dndDraggingSource";
        this.dndDraggableDisabledClass = "dndDraggableDisabled";
        this.dndDragImageOffsetFunction = calculateDragImageOffset;
        this.dndStart = new EventEmitter();
        this.dndDrag = new EventEmitter();
        this.dndEnd = new EventEmitter();
        this.dndMoved = new EventEmitter();
        this.dndCopied = new EventEmitter();
        this.dndLinked = new EventEmitter();
        this.dndCanceled = new EventEmitter();
        this.draggable = true;
        this.isDragStarted = false;
        this.dragEventHandler = (/**
         * @param {?} event
         * @return {?}
         */
        function (event) { return _this.onDrag(event); });
    }
    Object.defineProperty(DndDraggableDirective.prototype, "dndDisableIf", {
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.draggable = !value;
            if (this.draggable) {
                this.renderer.removeClass(this.elementRef.nativeElement, this.dndDraggableDisabledClass);
            }
            else {
                this.renderer.addClass(this.elementRef.nativeElement, this.dndDraggableDisabledClass);
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DndDraggableDirective.prototype, "dndDisableDragIf", {
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.dndDisableIf = value;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DndDraggableDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            _this.elementRef.nativeElement.addEventListener("drag", _this.dragEventHandler);
        }));
    };
    /**
     * @return {?}
     */
    DndDraggableDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.elementRef.nativeElement.removeEventListener("drag", this.dragEventHandler);
        if (this.isDragStarted === true) {
            endDrag();
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    DndDraggableDirective.prototype.onDragStart = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (this.draggable === false) {
            return false;
        }
        // check if there is dnd handle and if the dnd handle was used to start the drag
        if (typeof this.dndHandle !== "undefined"
            && typeof event._dndUsingHandle === "undefined") {
            return false;
        }
        // initialize global state
        startDrag(event, this.dndEffectAllowed, this.dndType);
        this.isDragStarted = true;
        setDragData(event, { data: this.dndDraggable, type: this.dndType }, dndState.effectAllowed);
        this.dragImage = this.determineDragImage();
        // set dragging css class prior to setDragImage so styles are applied before
        // TODO breaking change: add class to elementRef rather than drag image which could be another element
        this.renderer.addClass(this.dragImage, this.dndDraggingClass);
        // set custom dragimage if present
        // set dragimage if drag is started from dndHandle
        if (typeof this.dndDragImageElementRef !== "undefined"
            || typeof event._dndUsingHandle !== "undefined") {
            setDragImage(event, this.dragImage, this.dndDragImageOffsetFunction);
        }
        // add dragging source css class on first drag event
        /** @type {?} */
        var unregister = this.renderer.listen(this.elementRef.nativeElement, "drag", (/**
         * @return {?}
         */
        function () {
            _this.renderer.addClass(_this.elementRef.nativeElement, _this.dndDraggingSourceClass);
            unregister();
        }));
        this.dndStart.emit(event);
        event.stopPropagation();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    DndDraggableDirective.prototype.onDrag = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.dndDrag.emit(event);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    DndDraggableDirective.prototype.onDragEnd = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        // get drop effect from custom stored state as its not reliable across browsers
        /** @type {?} */
        var dropEffect = dndState.dropEffect;
        /** @type {?} */
        var dropEffectEmitter;
        switch (dropEffect) {
            case "copy":
                dropEffectEmitter = this.dndCopied;
                break;
            case "link":
                dropEffectEmitter = this.dndLinked;
                break;
            case "move":
                dropEffectEmitter = this.dndMoved;
                break;
            default:
                dropEffectEmitter = this.dndCanceled;
                break;
        }
        dropEffectEmitter.emit(event);
        this.dndEnd.emit(event);
        // reset global state
        endDrag();
        this.isDragStarted = false;
        this.renderer.removeClass(this.dragImage, this.dndDraggingClass);
        // IE9 special hammering
        window.setTimeout((/**
         * @return {?}
         */
        function () {
            _this.renderer.removeClass(_this.elementRef.nativeElement, _this.dndDraggingSourceClass);
        }), 0);
        event.stopPropagation();
    };
    /**
     * @param {?} handle
     * @return {?}
     */
    DndDraggableDirective.prototype.registerDragHandle = /**
     * @param {?} handle
     * @return {?}
     */
    function (handle) {
        this.dndHandle = handle;
    };
    /**
     * @param {?} elementRef
     * @return {?}
     */
    DndDraggableDirective.prototype.registerDragImage = /**
     * @param {?} elementRef
     * @return {?}
     */
    function (elementRef) {
        this.dndDragImageElementRef = elementRef;
    };
    /**
     * @private
     * @return {?}
     */
    DndDraggableDirective.prototype.determineDragImage = /**
     * @private
     * @return {?}
     */
    function () {
        // evaluate custom drag image existence
        if (typeof this.dndDragImageElementRef !== "undefined") {
            return (/** @type {?} */ (this.dndDragImageElementRef.nativeElement));
        }
        else {
            return this.elementRef.nativeElement;
        }
    };
    /** @nocollapse */
    DndDraggableDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 },
        { type: NgZone }
    ]; };
    DndDraggableDirective.propDecorators = {
        dndDraggable: [{ type: Input }],
        dndEffectAllowed: [{ type: Input }],
        dndType: [{ type: Input }],
        dndDraggingClass: [{ type: Input }],
        dndDraggingSourceClass: [{ type: Input }],
        dndDraggableDisabledClass: [{ type: Input }],
        dndDragImageOffsetFunction: [{ type: Input }],
        dndStart: [{ type: Output }],
        dndDrag: [{ type: Output }],
        dndEnd: [{ type: Output }],
        dndMoved: [{ type: Output }],
        dndCopied: [{ type: Output }],
        dndLinked: [{ type: Output }],
        dndCanceled: [{ type: Output }],
        draggable: [{ type: HostBinding, args: ["attr.draggable",] }],
        dndDisableIf: [{ type: Input }],
        dndDisableDragIf: [{ type: Input }],
        onDragStart: [{ type: HostListener, args: ["dragstart", ["$event"],] }],
        onDragEnd: [{ type: HostListener, args: ["dragend", ["$event"],] }]
    };
DndDraggableDirective.ɵfac = function DndDraggableDirective_Factory(t) { return new (t || DndDraggableDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
DndDraggableDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: DndDraggableDirective, selectors: [["", "dndDraggable", ""]], hostVars: 1, hostBindings: function DndDraggableDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("dragstart", function DndDraggableDirective_dragstart_HostBindingHandler($event) { return ctx.onDragStart($event); })("dragend", function DndDraggableDirective_dragend_HostBindingHandler($event) { return ctx.onDragEnd($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("draggable", ctx.draggable);
    } }, inputs: { dndEffectAllowed: "dndEffectAllowed", dndDraggingClass: "dndDraggingClass", dndDraggingSourceClass: "dndDraggingSourceClass", dndDraggableDisabledClass: "dndDraggableDisabledClass", dndDragImageOffsetFunction: "dndDragImageOffsetFunction", dndDisableIf: "dndDisableIf", dndDisableDragIf: "dndDisableDragIf", dndDraggable: "dndDraggable", dndType: "dndType" }, outputs: { dndStart: "dndStart", dndDrag: "dndDrag", dndEnd: "dndEnd", dndMoved: "dndMoved", dndCopied: "dndCopied", dndLinked: "dndLinked", dndCanceled: "dndCanceled" } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DndDraggableDirective, [{
        type: Directive,
        args: [{
                selector: "[dndDraggable]"
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc0.NgZone }]; }, { dndEffectAllowed: [{
            type: Input
        }], dndDraggingClass: [{
            type: Input
        }], dndDraggingSourceClass: [{
            type: Input
        }], dndDraggableDisabledClass: [{
            type: Input
        }], dndDragImageOffsetFunction: [{
            type: Input
        }], dndStart: [{
            type: Output
        }], dndDrag: [{
            type: Output
        }], dndEnd: [{
            type: Output
        }], dndMoved: [{
            type: Output
        }], dndCopied: [{
            type: Output
        }], dndLinked: [{
            type: Output
        }], dndCanceled: [{
            type: Output
        }], draggable: [{
            type: HostBinding,
            args: ["attr.draggable"]
        }], dndDisableIf: [{
            type: Input
        }], dndDisableDragIf: [{
            type: Input
        }], onDragStart: [{
            type: HostListener,
            args: ["dragstart", ["$event"]]
        }], onDragEnd: [{
            type: HostListener,
            args: ["dragend", ["$event"]]
        }], dndDraggable: [{
            type: Input
        }], dndType: [{
            type: Input
        }] }); })();
    return DndDraggableDirective;
}());
export { DndDraggableDirective };
if (false) {
    /** @type {?} */
    DndDraggableDirective.prototype.dndDraggable;
    /** @type {?} */
    DndDraggableDirective.prototype.dndEffectAllowed;
    /** @type {?} */
    DndDraggableDirective.prototype.dndType;
    /** @type {?} */
    DndDraggableDirective.prototype.dndDraggingClass;
    /** @type {?} */
    DndDraggableDirective.prototype.dndDraggingSourceClass;
    /** @type {?} */
    DndDraggableDirective.prototype.dndDraggableDisabledClass;
    /** @type {?} */
    DndDraggableDirective.prototype.dndDragImageOffsetFunction;
    /** @type {?} */
    DndDraggableDirective.prototype.dndStart;
    /** @type {?} */
    DndDraggableDirective.prototype.dndDrag;
    /** @type {?} */
    DndDraggableDirective.prototype.dndEnd;
    /** @type {?} */
    DndDraggableDirective.prototype.dndMoved;
    /** @type {?} */
    DndDraggableDirective.prototype.dndCopied;
    /** @type {?} */
    DndDraggableDirective.prototype.dndLinked;
    /** @type {?} */
    DndDraggableDirective.prototype.dndCanceled;
    /** @type {?} */
    DndDraggableDirective.prototype.draggable;
    /**
     * @type {?}
     * @private
     */
    DndDraggableDirective.prototype.dndHandle;
    /**
     * @type {?}
     * @private
     */
    DndDraggableDirective.prototype.dndDragImageElementRef;
    /**
     * @type {?}
     * @private
     */
    DndDraggableDirective.prototype.dragImage;
    /**
     * @type {?}
     * @private
     */
    DndDraggableDirective.prototype.isDragStarted;
    /**
     * @type {?}
     * @private
     */
    DndDraggableDirective.prototype.dragEventHandler;
    /**
     * @type {?}
     * @private
     */
    DndDraggableDirective.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    DndDraggableDirective.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    DndDraggableDirective.prototype.ngZone;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG5kLWRyYWdnYWJsZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VzIjpbIm5nOi9uZ3gtZHJhZy1kcm9wL2RuZC1kcmFnZ2FibGUuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBRUwsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osV0FBVyxFQUNYLFlBQVksRUFDWixLQUFLLEVBQ0wsTUFBTSxFQUVOLE1BQU0sRUFDTixTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLHdCQUF3QixFQUF3QyxXQUFXLEVBQUUsWUFBWSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRXhILE9BQU8sRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGFBQWEsQ0FBQzs7QUFHM0Q7QUFHVSxJQUVSLGtDQUFhLE1BQTRCLEVBQzVCLFVBQXFCO0FBQUksUUFFcEMsTUFBTSxDQUFDLGlCQUFpQixDQUFFLFVBQVUsQ0FBRSxDQUFDO0FBQzNDLElBQUUsQ0FBQyxBQU5LO0FBQUM7cUNBSFIsU0FBUyxTQUFFLHZEQUdvQjtRQUY5QixRQUFRLEVBQUUsbUJBQW1CLHJDQUtoQixnQkFETyxxQkFBcUI7Y0FIMUMsZEFJQyxnQkFyQkEsVUFBVTtBQUNYOzs7Ozs7Ozs0R0FBUztBQUFDLElBd0JYLCtCQUFDO0FBRUQsQ0FGQyxBQVZELElBVUM7QUFDRCxTQVJhLHdCQUF3QjtBQVNyQztBQUdVLElBNkVSLCtCQUFxQixVQUFxQixFQUNyQixRQUFrQixFQUNsQixNQUFhO0FBQUksUUFGdEMsaUJBR0M7QUFDSCxRQUp1QixlQUFVLEdBQVYsVUFBVSxDQUFXO0FBQUMsUUFDdEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtBQUFDLFFBQ25CLFdBQU0sR0FBTixNQUFNLENBQU87QUFBQyxRQXpFbkMscUJBQWdCLEdBQWlCLE1BQU0sQ0FBQztBQUMxQyxRQUtFLHFCQUFnQixHQUFHLGFBQWEsQ0FBQztBQUNuQyxRQUVFLDJC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QjtBQUNuQjtBQUVTLElBRFAsaURBQ3dDO0FBQzFDO0FBRVMsSUFEUCx3Q0FDZ0I7QUFDbEI7QUFFUyxJQURQLGlEQUNpQztBQUNuQztBQUVTLElBRFAsdURBQzZDO0FBQy9DO0FBRVMsSUFEUCwwREFDbUQ7QUFDckQ7QUFFUyxJQURQLDJEQUNpRjtBQUNuRjtBQUVRLElBRE4seUNBQzBFO0FBQzVFO0FBRVEsSUFETix3Q0FDeUU7QUFDM0U7QUFFUSxJQUROLHVDQUN3RTtBQUMxRTtBQUVRLElBRE4seUNBQzBFO0FBQzVFO0FBRVEsSUFETiwwQ0FDMkU7QUFDN0U7QUFFUSxJQUROLDBDQUMyRTtBQUM3RTtBQUVRLElBRE4sNENBQzZFO0FBQy9FO0FBQ29CLElBQWxCLDBDQUNpQjtBQUNuQjtBQUNPO0FBQWlCO0FBQWdCO0FBRWxDLElBRkosMENBQXNDO0FBQ3hDO0FBQ087QUFBaUI7QUFBZ0I7QUFFdkMsSUFGQyx1REFBMkM7QUFDN0M7QUFDTztBQUFpQjtBQUVkO0FBQVEsSUFGaEIsMENBQTBCO0FBQzVCO0FBQ087QUFBaUI7QUFBZ0I7QUFFbEMsSUFGSiw4Q0FBc0M7QUFDeEM7QUFDTztBQUFpQjtBQUFnQjtBQUFRLElBQTlDLGlEQUE0RztBQUM5RztBQUNPO0FBQ007QUFBZ0I7QUFBUSxJQW1CdEIsMkNBQTZCO0FBQUM7QUFDdEM7QUFBaUI7QUFBZ0I7QUFDbkMsSUFEVSx5Q0FBMEI7QUFBQztBQUNuQztBQUFpQjtBQUFnQjtBQUd0QyxJQUhhLHVDQUFxQjtBQUFDO0FBQUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBEaXJlY3RpdmUsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIEhvc3RMaXN0ZW5lcixcbiAgSW5wdXQsXG4gIE5nWm9uZSxcbiAgT25EZXN0cm95LFxuICBPdXRwdXQsXG4gIFJlbmRlcmVyMlxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgY2FsY3VsYXRlRHJhZ0ltYWdlT2Zmc2V0LCBEbmREcmFnSW1hZ2VPZmZzZXRGdW5jdGlvbiwgRG5kRXZlbnQsIHNldERyYWdEYXRhLCBzZXREcmFnSW1hZ2UgfSBmcm9tIFwiLi9kbmQtdXRpbHNcIjtcbmltcG9ydCB7IERuZEhhbmRsZURpcmVjdGl2ZSB9IGZyb20gXCIuL2RuZC1oYW5kbGUuZGlyZWN0aXZlXCI7XG5pbXBvcnQgeyBkbmRTdGF0ZSwgZW5kRHJhZywgc3RhcnREcmFnIH0gZnJvbSBcIi4vZG5kLXN0YXRlXCI7XG5pbXBvcnQgeyBFZmZlY3RBbGxvd2VkIH0gZnJvbSBcIi4vZG5kLXR5cGVzXCI7XG5cbkBEaXJlY3RpdmUoIHtcbiAgc2VsZWN0b3I6IFwiW2RuZERyYWdJbWFnZVJlZl1cIlxufSApXG5leHBvcnQgY2xhc3MgRG5kRHJhZ0ltYWdlUmVmRGlyZWN0aXZlIHtcblxuICBjb25zdHJ1Y3RvciggcGFyZW50OkRuZERyYWdnYWJsZURpcmVjdGl2ZSxcbiAgICAgICAgICAgICAgIGVsZW1lbnRSZWY6RWxlbWVudFJlZiApIHtcblxuICAgIHBhcmVudC5yZWdpc3RlckRyYWdJbWFnZSggZWxlbWVudFJlZiApO1xuICB9XG59XG5cbkBEaXJlY3RpdmUoIHtcbiAgc2VsZWN0b3I6IFwiW2RuZERyYWdnYWJsZV1cIlxufSApXG5leHBvcnQgY2xhc3MgRG5kRHJhZ2dhYmxlRGlyZWN0aXZlIGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcblxuICBASW5wdXQoKVxuICBkbmREcmFnZ2FibGU6YW55O1xuXG4gIEBJbnB1dCgpXG4gIGRuZEVmZmVjdEFsbG93ZWQ6RWZmZWN0QWxsb3dlZCA9IFwiY29weVwiO1xuXG4gIEBJbnB1dCgpXG4gIGRuZFR5cGU/OnN0cmluZztcblxuICBASW5wdXQoKVxuICBkbmREcmFnZ2luZ0NsYXNzID0gXCJkbmREcmFnZ2luZ1wiO1xuXG4gIEBJbnB1dCgpXG4gIGRuZERyYWdnaW5nU291cmNlQ2xhc3MgPSBcImRuZERyYWdnaW5nU291cmNlXCI7XG5cbiAgQElucHV0KClcbiAgZG5kRHJhZ2dhYmxlRGlzYWJsZWRDbGFzcyA9IFwiZG5kRHJhZ2dhYmxlRGlzYWJsZWRcIjtcblxuICBASW5wdXQoKVxuICBkbmREcmFnSW1hZ2VPZmZzZXRGdW5jdGlvbjpEbmREcmFnSW1hZ2VPZmZzZXRGdW5jdGlvbiA9IGNhbGN1bGF0ZURyYWdJbWFnZU9mZnNldDtcblxuICBAT3V0cHV0KClcbiAgcmVhZG9ubHkgZG5kU3RhcnQ6RXZlbnRFbWl0dGVyPERyYWdFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPERyYWdFdmVudD4oKTtcblxuICBAT3V0cHV0KClcbiAgcmVhZG9ubHkgZG5kRHJhZzpFdmVudEVtaXR0ZXI8RHJhZ0V2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8RHJhZ0V2ZW50PigpO1xuXG4gIEBPdXRwdXQoKVxuICByZWFkb25seSBkbmRFbmQ6RXZlbnRFbWl0dGVyPERyYWdFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPERyYWdFdmVudD4oKTtcblxuICBAT3V0cHV0KClcbiAgcmVhZG9ubHkgZG5kTW92ZWQ6RXZlbnRFbWl0dGVyPERyYWdFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPERyYWdFdmVudD4oKTtcblxuICBAT3V0cHV0KClcbiAgcmVhZG9ubHkgZG5kQ29waWVkOkV2ZW50RW1pdHRlcjxEcmFnRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxEcmFnRXZlbnQ+KCk7XG5cbiAgQE91dHB1dCgpXG4gIHJlYWRvbmx5IGRuZExpbmtlZDpFdmVudEVtaXR0ZXI8RHJhZ0V2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8RHJhZ0V2ZW50PigpO1xuXG4gIEBPdXRwdXQoKVxuICByZWFkb25seSBkbmRDYW5jZWxlZDpFdmVudEVtaXR0ZXI8RHJhZ0V2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8RHJhZ0V2ZW50PigpO1xuXG4gIEBIb3N0QmluZGluZyggXCJhdHRyLmRyYWdnYWJsZVwiIClcbiAgZHJhZ2dhYmxlID0gdHJ1ZTtcblxuICBwcml2YXRlIGRuZEhhbmRsZT86RG5kSGFuZGxlRGlyZWN0aXZlO1xuXG4gIHByaXZhdGUgZG5kRHJhZ0ltYWdlRWxlbWVudFJlZj86RWxlbWVudFJlZjtcblxuICBwcml2YXRlIGRyYWdJbWFnZTpFbGVtZW50O1xuXG4gIHByaXZhdGUgaXNEcmFnU3RhcnRlZDpib29sZWFuID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBkcmFnRXZlbnRIYW5kbGVyOiggZXZlbnQ6RHJhZ0V2ZW50ICkgPT4gdm9pZCA9ICggZXZlbnQ6RHJhZ0V2ZW50ICkgPT4gdGhpcy5vbkRyYWcoIGV2ZW50ICk7XG5cbiAgQElucHV0KClcbiAgc2V0IGRuZERpc2FibGVJZiggdmFsdWU6Ym9vbGVhbiApIHtcblxuICAgIHRoaXMuZHJhZ2dhYmxlID0gIXZhbHVlO1xuXG4gICAgaWYoIHRoaXMuZHJhZ2dhYmxlICkge1xuXG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKCB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgdGhpcy5kbmREcmFnZ2FibGVEaXNhYmxlZENsYXNzICk7XG4gICAgfVxuICAgIGVsc2Uge1xuXG4gICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKCB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgdGhpcy5kbmREcmFnZ2FibGVEaXNhYmxlZENsYXNzICk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KClcbiAgc2V0IGRuZERpc2FibGVEcmFnSWYoIHZhbHVlOmJvb2xlYW4gKSB7XG4gICAgdGhpcy5kbmREaXNhYmxlSWYgPSB2YWx1ZTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKCBwcml2YXRlIGVsZW1lbnRSZWY6RWxlbWVudFJlZixcbiAgICAgICAgICAgICAgIHByaXZhdGUgcmVuZGVyZXI6UmVuZGVyZXIyLFxuICAgICAgICAgICAgICAgcHJpdmF0ZSBuZ1pvbmU6Tmdab25lICkge1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCk6dm9pZCB7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoICgpID0+IHtcbiAgICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoIFwiZHJhZ1wiLCB0aGlzLmRyYWdFdmVudEhhbmRsZXIgKTtcbiAgICB9ICk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOnZvaWQge1xuICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIFwiZHJhZ1wiLCB0aGlzLmRyYWdFdmVudEhhbmRsZXIgKTtcbiAgICBpZih0aGlzLmlzRHJhZ1N0YXJ0ZWQgPT09IHRydWUpIHtcbiAgICAgIGVuZERyYWcoKVxuICAgIH1cbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoIFwiZHJhZ3N0YXJ0XCIsIFsgXCIkZXZlbnRcIiBdIClcbiAgb25EcmFnU3RhcnQoIGV2ZW50OkRuZEV2ZW50ICkge1xuXG4gICAgaWYoIHRoaXMuZHJhZ2dhYmxlID09PSBmYWxzZSApIHtcblxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIGNoZWNrIGlmIHRoZXJlIGlzIGRuZCBoYW5kbGUgYW5kIGlmIHRoZSBkbmQgaGFuZGxlIHdhcyB1c2VkIHRvIHN0YXJ0IHRoZSBkcmFnXG4gICAgaWYoIHR5cGVvZiB0aGlzLmRuZEhhbmRsZSAhPT0gXCJ1bmRlZmluZWRcIlxuICAgICAgJiYgdHlwZW9mIGV2ZW50Ll9kbmRVc2luZ0hhbmRsZSA9PT0gXCJ1bmRlZmluZWRcIiApIHtcblxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIGluaXRpYWxpemUgZ2xvYmFsIHN0YXRlXG4gICAgc3RhcnREcmFnKCBldmVudCwgdGhpcy5kbmRFZmZlY3RBbGxvd2VkLCB0aGlzLmRuZFR5cGUgKTtcblxuICAgIHRoaXMuaXNEcmFnU3RhcnRlZCA9IHRydWU7XG5cbiAgICBzZXREcmFnRGF0YSggZXZlbnQsIHtkYXRhOiB0aGlzLmRuZERyYWdnYWJsZSwgdHlwZTogdGhpcy5kbmRUeXBlfSwgZG5kU3RhdGUuZWZmZWN0QWxsb3dlZCApO1xuXG4gICAgdGhpcy5kcmFnSW1hZ2UgPSB0aGlzLmRldGVybWluZURyYWdJbWFnZSgpO1xuXG4gICAgLy8gc2V0IGRyYWdnaW5nIGNzcyBjbGFzcyBwcmlvciB0byBzZXREcmFnSW1hZ2Ugc28gc3R5bGVzIGFyZSBhcHBsaWVkIGJlZm9yZVxuICAgIC8vIFRPRE8gYnJlYWtpbmcgY2hhbmdlOiBhZGQgY2xhc3MgdG8gZWxlbWVudFJlZiByYXRoZXIgdGhhbiBkcmFnIGltYWdlIHdoaWNoIGNvdWxkIGJlIGFub3RoZXIgZWxlbWVudFxuICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3MoIHRoaXMuZHJhZ0ltYWdlLCB0aGlzLmRuZERyYWdnaW5nQ2xhc3MgKTtcblxuICAgIC8vIHNldCBjdXN0b20gZHJhZ2ltYWdlIGlmIHByZXNlbnRcbiAgICAvLyBzZXQgZHJhZ2ltYWdlIGlmIGRyYWcgaXMgc3RhcnRlZCBmcm9tIGRuZEhhbmRsZVxuICAgIGlmKCB0eXBlb2YgdGhpcy5kbmREcmFnSW1hZ2VFbGVtZW50UmVmICE9PSBcInVuZGVmaW5lZFwiXG4gICAgICB8fCB0eXBlb2YgZXZlbnQuX2RuZFVzaW5nSGFuZGxlICE9PSBcInVuZGVmaW5lZFwiICkge1xuXG4gICAgICBzZXREcmFnSW1hZ2UoIGV2ZW50LCB0aGlzLmRyYWdJbWFnZSwgdGhpcy5kbmREcmFnSW1hZ2VPZmZzZXRGdW5jdGlvbiApO1xuICAgIH1cblxuICAgIC8vIGFkZCBkcmFnZ2luZyBzb3VyY2UgY3NzIGNsYXNzIG9uIGZpcnN0IGRyYWcgZXZlbnRcbiAgICBjb25zdCB1bnJlZ2lzdGVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4oIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCBcImRyYWdcIiwgKCkgPT4ge1xuXG4gICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKCB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgdGhpcy5kbmREcmFnZ2luZ1NvdXJjZUNsYXNzICk7XG4gICAgICB1bnJlZ2lzdGVyKCk7XG4gICAgfSApO1xuXG4gICAgdGhpcy5kbmRTdGFydC5lbWl0KCBldmVudCApO1xuXG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIH1cblxuICBvbkRyYWcoIGV2ZW50OkRyYWdFdmVudCApIHtcblxuICAgIHRoaXMuZG5kRHJhZy5lbWl0KCBldmVudCApO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lciggXCJkcmFnZW5kXCIsIFsgXCIkZXZlbnRcIiBdIClcbiAgb25EcmFnRW5kKCBldmVudDpEcmFnRXZlbnQgKSB7XG5cbiAgICAvLyBnZXQgZHJvcCBlZmZlY3QgZnJvbSBjdXN0b20gc3RvcmVkIHN0YXRlIGFzIGl0cyBub3QgcmVsaWFibGUgYWNyb3NzIGJyb3dzZXJzXG4gICAgY29uc3QgZHJvcEVmZmVjdCA9IGRuZFN0YXRlLmRyb3BFZmZlY3Q7XG5cbiAgICBsZXQgZHJvcEVmZmVjdEVtaXR0ZXI6RXZlbnRFbWl0dGVyPERyYWdFdmVudD47XG5cbiAgICBzd2l0Y2goIGRyb3BFZmZlY3QgKSB7XG5cbiAgICAgIGNhc2UgXCJjb3B5XCI6XG4gICAgICAgIGRyb3BFZmZlY3RFbWl0dGVyID0gdGhpcy5kbmRDb3BpZWQ7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFwibGlua1wiOlxuICAgICAgICBkcm9wRWZmZWN0RW1pdHRlciA9IHRoaXMuZG5kTGlua2VkO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBcIm1vdmVcIjpcbiAgICAgICAgZHJvcEVmZmVjdEVtaXR0ZXIgPSB0aGlzLmRuZE1vdmVkO1xuICAgICAgICBicmVhaztcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgZHJvcEVmZmVjdEVtaXR0ZXIgPSB0aGlzLmRuZENhbmNlbGVkO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICBkcm9wRWZmZWN0RW1pdHRlci5lbWl0KCBldmVudCApO1xuICAgIHRoaXMuZG5kRW5kLmVtaXQoIGV2ZW50ICk7XG5cbiAgICAvLyByZXNldCBnbG9iYWwgc3RhdGVcbiAgICBlbmREcmFnKCk7XG5cbiAgICB0aGlzLmlzRHJhZ1N0YXJ0ZWQgPSBmYWxzZTtcblxuICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2xhc3MoIHRoaXMuZHJhZ0ltYWdlLCB0aGlzLmRuZERyYWdnaW5nQ2xhc3MgKTtcblxuICAgIC8vIElFOSBzcGVjaWFsIGhhbW1lcmluZ1xuICAgIHdpbmRvdy5zZXRUaW1lb3V0KCAoKSA9PiB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKCB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgdGhpcy5kbmREcmFnZ2luZ1NvdXJjZUNsYXNzICk7XG4gICAgfSwgMCApO1xuXG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIH1cblxuICByZWdpc3RlckRyYWdIYW5kbGUoIGhhbmRsZTpEbmRIYW5kbGVEaXJlY3RpdmUgfCB1bmRlZmluZWQgKSB7XG5cbiAgICB0aGlzLmRuZEhhbmRsZSA9IGhhbmRsZTtcbiAgfVxuXG4gIHJlZ2lzdGVyRHJhZ0ltYWdlKCBlbGVtZW50UmVmOkVsZW1lbnRSZWYgfCB1bmRlZmluZWQgKSB7XG5cbiAgICB0aGlzLmRuZERyYWdJbWFnZUVsZW1lbnRSZWYgPSBlbGVtZW50UmVmO1xuICB9XG5cbiAgcHJpdmF0ZSBkZXRlcm1pbmVEcmFnSW1hZ2UoKTpFbGVtZW50IHtcblxuICAgIC8vIGV2YWx1YXRlIGN1c3RvbSBkcmFnIGltYWdlIGV4aXN0ZW5jZVxuICAgIGlmKCB0eXBlb2YgdGhpcy5kbmREcmFnSW1hZ2VFbGVtZW50UmVmICE9PSBcInVuZGVmaW5lZFwiICkge1xuXG4gICAgICByZXR1cm4gdGhpcy5kbmREcmFnSW1hZ2VFbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQgYXMgRWxlbWVudDtcbiAgICB9XG4gICAgZWxzZSB7XG5cbiAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcbiAgICB9XG4gIH1cbn1cbiJdfQ==