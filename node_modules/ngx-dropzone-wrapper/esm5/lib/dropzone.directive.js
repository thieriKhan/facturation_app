import { __decorate, __param } from "tslib";
import Dropzone from 'dropzone';
import { PLATFORM_ID } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import { NgZone, Inject, Optional, ElementRef, Renderer2, Directive, OnInit, OnDestroy, DoCheck, OnChanges, Input, Output, EventEmitter, SimpleChanges, KeyValueDiffer, KeyValueDiffers } from '@angular/core';
import { DROPZONE_CONFIG, DropzoneConfig, DropzoneEvents } from './dropzone.interfaces';
import * as Éµngcc0 from '@angular/core';
var DropzoneDirective = /** @class */ (function () {
    function DropzoneDirective(zone, renderer, elementRef, differs, platformId, defaults) {
        this.zone = zone;
        this.renderer = renderer;
        this.elementRef = elementRef;
        this.differs = differs;
        this.platformId = platformId;
        this.defaults = defaults;
        this.configDiff = null;
        this.disabled = false;
        this.DZ_INIT = new EventEmitter();
        this.DZ_ERROR = new EventEmitter();
        this.DZ_SUCCESS = new EventEmitter();
        this.DZ_SENDING = new EventEmitter();
        this.DZ_CANCELED = new EventEmitter();
        this.DZ_COMPLETE = new EventEmitter();
        this.DZ_PROCESSING = new EventEmitter();
        this.DZ_DROP = new EventEmitter();
        this.DZ_DRAGSTART = new EventEmitter();
        this.DZ_DRAGEND = new EventEmitter();
        this.DZ_DRAGENTER = new EventEmitter();
        this.DZ_DRAGOVER = new EventEmitter();
        this.DZ_DRAGLEAVE = new EventEmitter();
        this.DZ_THUMBNAIL = new EventEmitter();
        this.DZ_ADDEDFILE = new EventEmitter();
        this.DZ_REMOVEDFILE = new EventEmitter();
        this.DZ_UPLOADPROGRESS = new EventEmitter();
        this.DZ_MAXFILESREACHED = new EventEmitter();
        this.DZ_MAXFILESEXCEEDED = new EventEmitter();
        this.DZ_SUCCESSMULTIPLE = new EventEmitter();
        this.DZ_SENDINGMULTIPLE = new EventEmitter();
        this.DZ_CANCELEDMULTIPLE = new EventEmitter();
        this.DZ_COMPLETEMULTIPLE = new EventEmitter();
        this.DZ_PROCESSINGMULTIPLE = new EventEmitter();
        this.DZ_RESET = new EventEmitter();
        this.DZ_QUEUECOMPLETE = new EventEmitter();
        this.DZ_TOTALUPLOADPROGRESS = new EventEmitter();
        var dz = Dropzone;
        dz.autoDiscover = false;
    }
    DropzoneDirective.prototype.ngOnInit = function () {
        var _this = this;
        if (!isPlatformBrowser(this.platformId)) {
            return;
        }
        var params = new DropzoneConfig(this.defaults);
        params.assign(this.config); // Custom configuration
        this.renderer.addClass(this.elementRef.nativeElement, (params.maxFiles === 1) ? 'dz-single' : 'dz-multiple');
        this.renderer.removeClass(this.elementRef.nativeElement, (params.maxFiles === 1) ? 'dz-multiple' : 'dz-single');
        this.zone.runOutsideAngular(function () {
            _this.instance = new Dropzone(_this.elementRef.nativeElement, params);
        });
        if (this.disabled) {
            this.instance.disable();
        }
        if (this.DZ_INIT.observers.length) {
            this.zone.run(function () {
                _this.DZ_INIT.emit(_this.instance);
            });
        }
        // Add auto reset handling for events
        this.instance.on('success', function () {
            if (params.autoReset != null) {
                setTimeout(function () { return _this.reset(); }, params.autoReset);
            }
        });
        this.instance.on('error', function () {
            if (params.errorReset != null) {
                setTimeout(function () { return _this.reset(); }, params.errorReset);
            }
        });
        this.instance.on('canceled', function () {
            if (params.cancelReset != null) {
                setTimeout(function () { return _this.reset(); }, params.cancelReset);
            }
        });
        // Add native Dropzone event handling
        DropzoneEvents.forEach(function (eventName) {
            _this.instance.on(eventName.toLowerCase(), function () {
                var args = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    args[_i] = arguments[_i];
                }
                args = (args.length === 1) ? args[0] : args;
                var output = "DZ_" + eventName.toUpperCase();
                var emitter = _this[output];
                if (emitter.observers.length > 0) {
                    _this.zone.run(function () {
                        emitter.emit(args);
                    });
                }
            });
        });
        if (!this.configDiff) {
            this.configDiff = this.differs.find(this.config || {}).create();
            this.configDiff.diff(this.config || {});
        }
    };
    DropzoneDirective.prototype.ngOnDestroy = function () {
        var _this = this;
        if (this.instance) {
            this.zone.runOutsideAngular(function () {
                _this.instance.destroy();
            });
            this.instance = null;
        }
    };
    DropzoneDirective.prototype.ngDoCheck = function () {
        if (!this.disabled && this.configDiff) {
            var changes = this.configDiff.diff(this.config || {});
            if (changes && this.instance) {
                this.ngOnDestroy();
                this.ngOnInit();
            }
        }
    };
    DropzoneDirective.prototype.ngOnChanges = function (changes) {
        var _this = this;
        if (this.instance && changes['disabled']) {
            if (changes['disabled'].currentValue !== changes['disabled'].previousValue) {
                if (changes['disabled'].currentValue === false) {
                    this.zone.runOutsideAngular(function () {
                        _this.instance.enable();
                    });
                }
                else if (changes['disabled'].currentValue === true) {
                    this.zone.runOutsideAngular(function () {
                        _this.instance.disable();
                    });
                }
            }
        }
    };
    DropzoneDirective.prototype.dropzone = function () {
        return this.instance;
    };
    DropzoneDirective.prototype.reset = function (cancel) {
        var _this = this;
        if (this.instance) {
            this.zone.runOutsideAngular(function () {
                _this.instance.removeAllFiles(cancel);
            });
        }
    };
    DropzoneDirective.ctorParameters = function () { return [
        { type: NgZone },
        { type: Renderer2 },
        { type: ElementRef },
        { type: KeyValueDiffers },
        { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] },
        { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [DROPZONE_CONFIG,] }] }
    ]; };
    __decorate([
        Input()
    ], DropzoneDirective.prototype, "disabled", void 0);
    __decorate([
        Input('dropzone')
    ], DropzoneDirective.prototype, "config", void 0);
    __decorate([
        Output('init')
    ], DropzoneDirective.prototype, "DZ_INIT", void 0);
    __decorate([
        Output('error')
    ], DropzoneDirective.prototype, "DZ_ERROR", void 0);
    __decorate([
        Output('success')
    ], DropzoneDirective.prototype, "DZ_SUCCESS", void 0);
    __decorate([
        Output('sending')
    ], DropzoneDirective.prototype, "DZ_SENDING", void 0);
    __decorate([
        Output('canceled')
    ], DropzoneDirective.prototype, "DZ_CANCELED", void 0);
    __decorate([
        Output('complete')
    ], DropzoneDirective.prototype, "DZ_COMPLETE", void 0);
    __decorate([
        Output('processing')
    ], DropzoneDirective.prototype, "DZ_PROCESSING", void 0);
    __decorate([
        Output('drop')
    ], DropzoneDirective.prototype, "DZ_DROP", void 0);
    __decorate([
        Output('dragStart')
    ], DropzoneDirective.prototype, "DZ_DRAGSTART", void 0);
    __decorate([
        Output('dragEnd')
    ], DropzoneDirective.prototype, "DZ_DRAGEND", void 0);
    __decorate([
        Output('dragEnter')
    ], DropzoneDirective.prototype, "DZ_DRAGENTER", void 0);
    __decorate([
        Output('dragOver')
    ], DropzoneDirective.prototype, "DZ_DRAGOVER", void 0);
    __decorate([
        Output('dragLeave')
    ], DropzoneDirective.prototype, "DZ_DRAGLEAVE", void 0);
    __decorate([
        Output('thumbnail')
    ], DropzoneDirective.prototype, "DZ_THUMBNAIL", void 0);
    __decorate([
        Output('addedFile')
    ], DropzoneDirective.prototype, "DZ_ADDEDFILE", void 0);
    __decorate([
        Output('removedFile')
    ], DropzoneDirective.prototype, "DZ_REMOVEDFILE", void 0);
    __decorate([
        Output('uploadProgress')
    ], DropzoneDirective.prototype, "DZ_UPLOADPROGRESS", void 0);
    __decorate([
        Output('maxFilesReached')
    ], DropzoneDirective.prototype, "DZ_MAXFILESREACHED", void 0);
    __decorate([
        Output('maxFilesExceeded')
    ], DropzoneDirective.prototype, "DZ_MAXFILESEXCEEDED", void 0);
    __decorate([
        Output('successMultiple')
    ], DropzoneDirective.prototype, "DZ_SUCCESSMULTIPLE", void 0);
    __decorate([
        Output('sendingMultiple')
    ], DropzoneDirective.prototype, "DZ_SENDINGMULTIPLE", void 0);
    __decorate([
        Output('canceledMultiple')
    ], DropzoneDirective.prototype, "DZ_CANCELEDMULTIPLE", void 0);
    __decorate([
        Output('completeMultiple')
    ], DropzoneDirective.prototype, "DZ_COMPLETEMULTIPLE", void 0);
    __decorate([
        Output('processingMultiple')
    ], DropzoneDirective.prototype, "DZ_PROCESSINGMULTIPLE", void 0);
    __decorate([
        Output('reset')
    ], DropzoneDirective.prototype, "DZ_RESET", void 0);
    __decorate([
        Output('queueComplete')
    ], DropzoneDirective.prototype, "DZ_QUEUECOMPLETE", void 0);
    __decorate([
        Output('totalUploadProgress')
    ], DropzoneDirective.prototype, "DZ_TOTALUPLOADPROGRESS", void 0);
    DropzoneDirective = __decorate([ __param(4, Inject(PLATFORM_ID)),
        __param(5, Optional()), __param(5, Inject(DROPZONE_CONFIG))
    ], DropzoneDirective);
DropzoneDirective.Éµfac = function DropzoneDirective_Factory(t) { return new (t || DropzoneDirective)(Éµngcc0.ÉµÉµdirectiveInject(Éµngcc0.NgZone), Éµngcc0.ÉµÉµdirectiveInject(Éµngcc0.Renderer2), Éµngcc0.ÉµÉµdirectiveInject(Éµngcc0.ElementRef), Éµngcc0.ÉµÉµdirectiveInject(Éµngcc0.KeyValueDiffers), Éµngcc0.ÉµÉµdirectiveInject(PLATFORM_ID), Éµngcc0.ÉµÉµdirectiveInject(DROPZONE_CONFIG, 8)); };
DropzoneDirective.Éµdir = Éµngcc0.ÉµÉµdefineDirective({ type: DropzoneDirective, selectors: [["", "dropzone", ""]], inputs: { disabled: "disabled", config: ["dropzone", "config"] }, outputs: { DZ_INIT: "init", DZ_ERROR: "error", DZ_SUCCESS: "success", DZ_SENDING: "sending", DZ_CANCELED: "canceled", DZ_COMPLETE: "complete", DZ_PROCESSING: "processing", DZ_DROP: "drop", DZ_DRAGSTART: "dragStart", DZ_DRAGEND: "dragEnd", DZ_DRAGENTER: "dragEnter", DZ_DRAGOVER: "dragOver", DZ_DRAGLEAVE: "dragLeave", DZ_THUMBNAIL: "thumbnail", DZ_ADDEDFILE: "addedFile", DZ_REMOVEDFILE: "removedFile", DZ_UPLOADPROGRESS: "uploadProgress", DZ_MAXFILESREACHED: "maxFilesReached", DZ_MAXFILESEXCEEDED: "maxFilesExceeded", DZ_SUCCESSMULTIPLE: "successMultiple", DZ_SENDINGMULTIPLE: "sendingMultiple", DZ_CANCELEDMULTIPLE: "canceledMultiple", DZ_COMPLETEMULTIPLE: "completeMultiple", DZ_PROCESSINGMULTIPLE: "processingMultiple", DZ_RESET: "reset", DZ_QUEUECOMPLETE: "queueComplete", DZ_TOTALUPLOADPROGRESS: "totalUploadProgress" }, exportAs: ["ngxDropzone"], features: [Éµngcc0.ÉµÉµNgOnChangesFeature] });
/*@__PURE__*/ (function () { Éµngcc0.ÉµsetClassMetadata(DropzoneDirective, [{
        type: Directive,
        args: [{
                selector: '[dropzone]',
                exportAs: 'ngxDropzone'
            }]
    }], function () { return [{ type: Éµngcc0.NgZone }, { type: Éµngcc0.Renderer2 }, { type: Éµngcc0.ElementRef }, { type: Éµngcc0.KeyValueDiffers }, { type: Object, decorators: [{
                type: Inject,
                args: [PLATFORM_ID]
            }] }, { type: undefined, decorators: [{
                type: Optional
            }, {
                type: Inject,
                args: [DROPZONE_CONFIG]
            }] }]; }, { disabled: [{
            type: Input
        }], DZ_INIT: [{
            type: Output,
            args: ['init']
        }], DZ_ERROR: [{
            type: Output,
            args: ['error']
        }], DZ_SUCCESS: [{
            type: Output,
            args: ['success']
        }], DZ_SENDING: [{
            type: Output,
            args: ['sending']
        }], DZ_CANCELED: [{
            type: Output,
            args: ['canceled']
        }], DZ_COMPLETE: [{
            type: Output,
            args: ['complete']
        }], DZ_PROCESSING: [{
            type: Output,
            args: ['processing']
        }], DZ_DROP: [{
            type: Output,
            args: ['drop']
        }], DZ_DRAGSTART: [{
            type: Output,
            args: ['dragStart']
        }], DZ_DRAGEND: [{
            type: Output,
            args: ['dragEnd']
        }], DZ_DRAGENTER: [{
            type: Output,
            args: ['dragEnter']
        }], DZ_DRAGOVER: [{
            type: Output,
            args: ['dragOver']
        }], DZ_DRAGLEAVE: [{
            type: Output,
            args: ['dragLeave']
        }], DZ_THUMBNAIL: [{
            type: Output,
            args: ['thumbnail']
        }], DZ_ADDEDFILE: [{
            type: Output,
            args: ['addedFile']
        }], DZ_REMOVEDFILE: [{
            type: Output,
            args: ['removedFile']
        }], DZ_UPLOADPROGRESS: [{
            type: Output,
            args: ['uploadProgress']
        }], DZ_MAXFILESREACHED: [{
            type: Output,
            args: ['maxFilesReached']
        }], DZ_MAXFILESEXCEEDED: [{
            type: Output,
            args: ['maxFilesExceeded']
        }], DZ_SUCCESSMULTIPLE: [{
            type: Output,
            args: ['successMultiple']
        }], DZ_SENDINGMULTIPLE: [{
            type: Output,
            args: ['sendingMultiple']
        }], DZ_CANCELEDMULTIPLE: [{
            type: Output,
            args: ['canceledMultiple']
        }], DZ_COMPLETEMULTIPLE: [{
            type: Output,
            args: ['completeMultiple']
        }], DZ_PROCESSINGMULTIPLE: [{
            type: Output,
            args: ['processingMultiple']
        }], DZ_RESET: [{
            type: Output,
            args: ['reset']
        }], DZ_QUEUECOMPLETE: [{
            type: Output,
            args: ['queueComplete']
        }], DZ_TOTALUPLOADPROGRESS: [{
            type: Output,
            args: ['totalUploadProgress']
        }], config: [{
            type: Input,
            args: ['dropzone']
        }] }); })();
    return DropzoneDirective;
}());
export { DropzoneDirective };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcHpvbmUuZGlyZWN0aXZlLmpzIiwic291cmNlcyI6WyJuZzovbmd4LWRyb3B6b25lLXdyYXBwZXIvbGliL2Ryb3B6b25lLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxRQUFRLE1BQU0sVUFBVSxDQUFDO0FBRWhDLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDNUMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDcEQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUNqRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQ2xFLGFBQWEsRUFBRSxjQUFjLEVBQUUsZUFBZSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXhFLE9BQU8sRUFBRSxlQUFlLEVBQUUsY0FBYyxFQUN2QixjQUFjLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQzs7QUFNL0Q7QUFBcUQsSUEwQ25ELDJCQUFvQixJQUFZLEVBQVUsUUFBbUIsRUFBVSxVQUFzQixFQUNuRixPQUF3QixFQUErQixVQUFrQixFQUNwQyxRQUFpQztBQUNoRixRQUhvQixTQUFJLEdBQUosSUFBSSxDQUFRO0FBQUMsUUFBUyxhQUFRLEdBQVIsUUFBUSxDQUFXO0FBQUMsUUFBUyxlQUFVLEdBQVYsVUFBVSxDQUFZO0FBQUMsUUFDcEYsWUFBTyxHQUFQLE9BQU8sQ0FBaUI7QUFBQyxRQUE4QixlQUFVLEdBQVYsVUFBVSxDQUFRO0FBQUMsUUFDckMsYUFBUSxHQUFSLFFBQVEsQ0FBeUI7QUFBQyxRQXpDekUsZUFBVSxHQUF1QyxJQUFJLENBQUM7QUFDaEUsUUFDVyxhQUFRLEdBQVksS0FBSyxDQUFDO0FBQ3JDLFFBR29DLFlBQU8sR0FBdUIsSUFBSSxZQUFZLEVBQU8sQ0FBQztBQUMxRixRQUNv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Q2hELEVBQUUsWUFBWSxjQUN0QixRQUFRLEVBQUUsYUFBYSwxREE2Q21DLFFBQ3ZELFdBQUEsUUFBUSxFQUFFLENBQUEsRUFBRSxXQUFBLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQTtBQTdDdkMsQ0FBQyxEQTZDdUMsT0E1QzVCLGlCQUFpQixDQTRLN0I7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQ0Q7QUFBQyxJQURELHdCQUFDO0FBQ0EsQ0FEQSxBQTVLRCxJQTRLQztBQUNELFNBN0thLGlCQUFpQjtBQUFJIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IERyb3B6b25lIGZyb20gJ2Ryb3B6b25lJztcblxuaW1wb3J0IHsgUExBVEZPUk1fSUQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IE5nWm9uZSwgSW5qZWN0LCBPcHRpb25hbCwgRWxlbWVudFJlZiwgUmVuZGVyZXIyLCBEaXJlY3RpdmUsXG4gIE9uSW5pdCwgT25EZXN0cm95LCBEb0NoZWNrLCBPbkNoYW5nZXMsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlcixcbiAgU2ltcGxlQ2hhbmdlcywgS2V5VmFsdWVEaWZmZXIsIEtleVZhbHVlRGlmZmVycyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBEUk9QWk9ORV9DT05GSUcsIERyb3B6b25lQ29uZmlnLCBEcm9wem9uZUNvbmZpZ0ludGVyZmFjZSxcbiAgRHJvcHpvbmVFdmVudCwgRHJvcHpvbmVFdmVudHMgfSBmcm9tICcuL2Ryb3B6b25lLmludGVyZmFjZXMnO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbZHJvcHpvbmVdJyxcbiAgZXhwb3J0QXM6ICduZ3hEcm9wem9uZSdcbn0pXG5leHBvcnQgY2xhc3MgRHJvcHpvbmVEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgRG9DaGVjaywgT25DaGFuZ2VzIHtcbiAgcHJpdmF0ZSBpbnN0YW5jZTogYW55O1xuXG4gIHByaXZhdGUgY29uZmlnRGlmZjogS2V5VmFsdWVEaWZmZXI8c3RyaW5nLCBhbnk+IHwgbnVsbCA9IG51bGw7XG5cbiAgQElucHV0KCkgZGlzYWJsZWQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBASW5wdXQoJ2Ryb3B6b25lJykgY29uZmlnPzogRHJvcHpvbmVDb25maWdJbnRlcmZhY2U7XG5cbiAgQE91dHB1dCgnaW5pdCcgICAgICAgICAgICAgICAgICApIERaX0lOSVQgICAgICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIEBPdXRwdXQoJ2Vycm9yJyAgICAgICAgICAgICAgICAgKSBEWl9FUlJPUiAgICAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnc3VjY2VzcycgICAgICAgICAgICAgICApIERaX1NVQ0NFU1MgICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdzZW5kaW5nJyAgICAgICAgICAgICAgICkgRFpfU0VORElORyAgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ2NhbmNlbGVkJyAgICAgICAgICAgICAgKSBEWl9DQU5DRUxFRCAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnY29tcGxldGUnICAgICAgICAgICAgICApIERaX0NPTVBMRVRFICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdwcm9jZXNzaW5nJyAgICAgICAgICAgICkgRFpfUFJPQ0VTU0lORyAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgQE91dHB1dCgnZHJvcCcgICAgICAgICAgICAgICAgICApIERaX0RST1AgICAgICAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdkcmFnU3RhcnQnICAgICAgICAgICAgICkgRFpfRFJBR1NUQVJUICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ2RyYWdFbmQnICAgICAgICAgICAgICAgKSBEWl9EUkFHRU5EICAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnZHJhZ0VudGVyJyAgICAgICAgICAgICApIERaX0RSQUdFTlRFUiAgICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdkcmFnT3ZlcicgICAgICAgICAgICAgICkgRFpfRFJBR09WRVIgICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ2RyYWdMZWF2ZScgICAgICAgICAgICAgKSBEWl9EUkFHTEVBVkUgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBAT3V0cHV0KCd0aHVtYm5haWwnICAgICAgICAgICAgICkgRFpfVEhVTUJOQUlMICAgICAgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ2FkZGVkRmlsZScgICAgICAgICAgICAgKSBEWl9BRERFREZJTEUgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgncmVtb3ZlZEZpbGUnICAgICAgICAgICApIERaX1JFTU9WRURGSUxFICAgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCd1cGxvYWRQcm9ncmVzcycgICAgICAgICkgRFpfVVBMT0FEUFJPR1JFU1MgICAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ21heEZpbGVzUmVhY2hlZCcgICAgICAgKSBEWl9NQVhGSUxFU1JFQUNIRUQgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnbWF4RmlsZXNFeGNlZWRlZCcgICAgICApIERaX01BWEZJTEVTRVhDRUVERUQgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIEBPdXRwdXQoJ3N1Y2Nlc3NNdWx0aXBsZScgICAgICAgKSBEWl9TVUNDRVNTTVVMVElQTEUgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgnc2VuZGluZ011bHRpcGxlJyAgICAgICApIERaX1NFTkRJTkdNVUxUSVBMRSAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCdjYW5jZWxlZE11bHRpcGxlJyAgICAgICkgRFpfQ0FOQ0VMRURNVUxUSVBMRSAgICAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoJ2NvbXBsZXRlTXVsdGlwbGUnICAgICAgKSBEWl9DT01QTEVURU1VTFRJUExFICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgncHJvY2Vzc2luZ011bHRpcGxlJyAgICApIERaX1BST0NFU1NJTkdNVUxUSVBMRSAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIEBPdXRwdXQoJ3Jlc2V0JyAgICAgICAgICAgICAgICAgKSBEWl9SRVNFVCAgICAgICAgICAgICAgICAgICAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgncXVldWVDb21wbGV0ZScgICAgICAgICApIERaX1FVRVVFQ09NUExFVEUgICAgICAgICAgICA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCd0b3RhbFVwbG9hZFByb2dyZXNzJyAgICkgRFpfVE9UQUxVUExPQURQUk9HUkVTUyAgICAgID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSB6b25lOiBOZ1pvbmUsIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxuICAgIHByaXZhdGUgZGlmZmVyczogS2V5VmFsdWVEaWZmZXJzLCBASW5qZWN0KFBMQVRGT1JNX0lEKSBwcml2YXRlIHBsYXRmb3JtSWQ6IE9iamVjdCxcbiAgICBAT3B0aW9uYWwoKSBASW5qZWN0KERST1BaT05FX0NPTkZJRykgcHJpdmF0ZSBkZWZhdWx0czogRHJvcHpvbmVDb25maWdJbnRlcmZhY2UpXG4gIHtcbiAgICBjb25zdCBkeiA9IERyb3B6b25lO1xuXG4gICAgZHouYXV0b0Rpc2NvdmVyID0gZmFsc2U7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICBpZiAoIWlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm1JZCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBwYXJhbXMgPSBuZXcgRHJvcHpvbmVDb25maWcodGhpcy5kZWZhdWx0cyk7XG5cbiAgICBwYXJhbXMuYXNzaWduKHRoaXMuY29uZmlnKTsgLy8gQ3VzdG9tIGNvbmZpZ3VyYXRpb25cblxuICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsXG4gICAgICAocGFyYW1zLm1heEZpbGVzID09PSAxKSA/ICdkei1zaW5nbGUnIDogJ2R6LW11bHRpcGxlJyk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LFxuICAgICAgKHBhcmFtcy5tYXhGaWxlcyA9PT0gMSkgPyAnZHotbXVsdGlwbGUnIDogJ2R6LXNpbmdsZScpO1xuXG4gICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIHRoaXMuaW5zdGFuY2UgPSBuZXcgRHJvcHpvbmUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsIHBhcmFtcyk7XG4gICAgfSk7XG5cbiAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xuICAgICAgdGhpcy5pbnN0YW5jZS5kaXNhYmxlKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuRFpfSU5JVC5vYnNlcnZlcnMubGVuZ3RoKSB7XG4gICAgICB0aGlzLnpvbmUucnVuKCgpID0+IHtcbiAgICAgICAgdGhpcy5EWl9JTklULmVtaXQodGhpcy5pbnN0YW5jZSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBBZGQgYXV0byByZXNldCBoYW5kbGluZyBmb3IgZXZlbnRzXG4gICAgdGhpcy5pbnN0YW5jZS5vbignc3VjY2VzcycsICgpID0+IHtcbiAgICAgIGlmIChwYXJhbXMuYXV0b1Jlc2V0ICE9IG51bGwpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnJlc2V0KCksIHBhcmFtcy5hdXRvUmVzZXQpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5pbnN0YW5jZS5vbignZXJyb3InLCAoKSA9PiB7XG4gICAgICBpZiAocGFyYW1zLmVycm9yUmVzZXQgIT0gbnVsbCkge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMucmVzZXQoKSwgcGFyYW1zLmVycm9yUmVzZXQpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5pbnN0YW5jZS5vbignY2FuY2VsZWQnLCAoKSA9PiB7XG4gICAgICBpZiAocGFyYW1zLmNhbmNlbFJlc2V0ICE9IG51bGwpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnJlc2V0KCksIHBhcmFtcy5jYW5jZWxSZXNldCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBBZGQgbmF0aXZlIERyb3B6b25lIGV2ZW50IGhhbmRsaW5nXG4gICAgRHJvcHpvbmVFdmVudHMuZm9yRWFjaCgoZXZlbnROYW1lOiBEcm9wem9uZUV2ZW50KSA9PiB7XG4gICAgICB0aGlzLmluc3RhbmNlLm9uKGV2ZW50TmFtZS50b0xvd2VyQ2FzZSgpLCAoLi4uYXJnczogYW55W10pID0+IHtcbiAgICAgICAgYXJncyA9IChhcmdzLmxlbmd0aCA9PT0gMSkgPyBhcmdzWzBdIDogYXJncztcblxuICAgICAgICBjb25zdCBvdXRwdXQgPSBgRFpfJHtldmVudE5hbWUudG9VcHBlckNhc2UoKX1gO1xuXG4gICAgICAgIGNvbnN0IGVtaXR0ZXIgPSB0aGlzW291dHB1dCBhcyBrZXlvZiBEcm9wem9uZURpcmVjdGl2ZV0gYXMgRXZlbnRFbWl0dGVyPGFueT47XG5cbiAgICAgICAgaWYgKGVtaXR0ZXIub2JzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB0aGlzLnpvbmUucnVuKCgpID0+IHtcbiAgICAgICAgICAgIGVtaXR0ZXIuZW1pdChhcmdzKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpZiAoIXRoaXMuY29uZmlnRGlmZikge1xuICAgICAgdGhpcy5jb25maWdEaWZmID0gdGhpcy5kaWZmZXJzLmZpbmQodGhpcy5jb25maWcgfHwge30pLmNyZWF0ZSgpO1xuXG4gICAgICB0aGlzLmNvbmZpZ0RpZmYuZGlmZih0aGlzLmNvbmZpZyB8fCB7fSk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaW5zdGFuY2UpIHtcbiAgICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIHRoaXMuaW5zdGFuY2UuZGVzdHJveSgpO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuaW5zdGFuY2UgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIG5nRG9DaGVjaygpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuZGlzYWJsZWQgJiYgdGhpcy5jb25maWdEaWZmKSB7XG4gICAgICBjb25zdCBjaGFuZ2VzID0gdGhpcy5jb25maWdEaWZmLmRpZmYodGhpcy5jb25maWcgfHwge30pO1xuXG4gICAgICBpZiAoY2hhbmdlcyAmJiB0aGlzLmluc3RhbmNlKSB7XG4gICAgICAgIHRoaXMubmdPbkRlc3Ryb3koKTtcblxuICAgICAgICB0aGlzLm5nT25Jbml0KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmICh0aGlzLmluc3RhbmNlICYmIGNoYW5nZXNbJ2Rpc2FibGVkJ10pIHtcbiAgICAgIGlmIChjaGFuZ2VzWydkaXNhYmxlZCddLmN1cnJlbnRWYWx1ZSAhPT0gY2hhbmdlc1snZGlzYWJsZWQnXS5wcmV2aW91c1ZhbHVlKSB7XG4gICAgICAgIGlmIChjaGFuZ2VzWydkaXNhYmxlZCddLmN1cnJlbnRWYWx1ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5lbmFibGUoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmIChjaGFuZ2VzWydkaXNhYmxlZCddLmN1cnJlbnRWYWx1ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlLmRpc2FibGUoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBkcm9wem9uZSgpOiBhbnkge1xuICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xuICB9XG5cbiAgcHVibGljIHJlc2V0KGNhbmNlbD86IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBpZiAodGhpcy5pbnN0YW5jZSkge1xuICAgICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5yZW1vdmVBbGxGaWxlcyhjYW5jZWwpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG59XG4iXX0=